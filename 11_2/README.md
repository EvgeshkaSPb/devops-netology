# Домашнее задание к занятию "11.02 Микросервисы: принципы"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- Маршрутизация запросов к нужному сервису на основе конфигурации
- Возможность проверки аутентификационной информации в запросах
- Обеспечение терминации HTTPS

Обоснуйте свой выбор.

## Ответ
На данный момент практически все крупные облачные провайдеры предоставляют собственную реализацию API gateway.  
Из зарубежных (актуальная ремарка в нынешнее время):  
Amazon API gateway, Azure API gateway, Oracle API gateaway, Google API Gateway  
Из отечественных:  
Sbercloud API gateway, Yandex API Gateway.  
При условии, что проект будет размещаться в облаке, имеет смысл рассматривать готовое облачное решение.  
Если проект размещен на собственной площадке тогда будем выбирать из следующих программных решений:  

| продукт       | Маршрутизация запросов | Проверка аутентификационной информации | Терминация HTTPS |
| ------------- |:----------------------:|---------------------------------------:|-----------------:|
| Kong Gateway  | + | + | + |
| Apache APISIX | + | + | + |
| Tyk           | + | + | + |
| KrakenD       | + | + | + |
| Ocelot        | + | + | + |
| F5 NGINX Plus | + | + | + |

Все из рассмотренных продуктов обладают необходимым функционалом.   
Возможно после более конкретного ознакомления с продуктом появятся дополнительные требования и выбор конкретезируется.  
На данный момент я бы выбрал Kong Gateway. Данные продукт очень популярен, он полностью бесплатен, имеет множество плагинов и хорошою документацию. Все эти нюансы положительно скажутся на внедрении и последующем использовании данного продукта.

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- Поддержка кластеризации для обеспечения надежности
- Хранение сообщений на диске в процессе доставки
- Высокая скорость работы
- Поддержка различных форматов сообщений
- Разделение прав доступа к различным потокам сообщений
- Протота эксплуатации

Обоснуйте свой выбор.

## Ответ
| продукт       | Кластеризация | Хранение сообщений на диске | Скорость работы | Форматы сообщений | Разделение прав доступа к различным потокам | Протота эксплуатации |
| :------------- |:----------------------:|--------------------------------------:|:-----------------:|:---:|:---:|:---:|
| Apache Kafka |  +   |   +    |  высокая | binary через TCP Socket | + | - |
| RabbitMQ | + | + | средняя | AMQP,STOMP,MQTT | + | + |
| Redis | + | -+ | высокая | RESP | + | + |
| NATS | + | -+ | высокая | NATS protocol | + | + |
| ActiveMQ | + | + | средняя | OpenWire,AMQP,STOMP,MQTT,AUTO и др | + | + |
| ZeroMQ | - | + | очень высокая | ZeroMQ library | + | + |

Выбор брокера сообщений тесно связан с самой архитектурой проекта и требованиями по быстродействию.  
Из всех перечисленных мне больше всего импонирует NATS. По отзывам он просто настраивается и администрируется.  
Требование записи сообщений на диск и быстродействие являются взаимоисключающими, т.к. скорость передачи сообщений по сети в разы выше скорости записи на диск. По этому скорость работы брокера резко падает при "активации" записи на диск.  
Если скорость работы не критична, тогода можно остановить свой выбор на RabbitMQ который является своебразным стандартом брокеров сообщений (Альфа версия вышла 8.02.2007). Соотвественно при этом выборе мы получаем хорошую документацию, огромное сообщество и массу примеров и вариантов настройки и оптимизации.
